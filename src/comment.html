<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <link rel="stylesheet" href="./css/comment.min.css">
</head>
<body>
<header>
  <div class="header-content">
    <div class="logo">
      <a class="logo-img" href="javascript:;">
        <img src="images/logo.png" alt="">
      </a>
    </div>
    <ul class="header-list">
      <li class="header-item address">
        <a href="javascript:;">
          <img src="images/citypoint.png" alt="">
          <span class="city">深圳</span>
          <span class="switch-city">切换城市</span>
        </a>
      </li>
      <li class="header-item on">
        <a href="javascript:;">首页</a>
      </li>
      <li class="header-item">
        <a href="javascript:;">到位APP</a>
      </li>
      <li class="header-item">
        <a href="facilitator.html">服务商</a>
      </li>
      <li class="header-item">
        <a href="javascript:;">商家入驻</a>
      </li>
      <li class="header-item">
        <a href="javascript:;">关于我们</a>
      </li>
      <li class="header-item shop-login">
        <a href="javascript:;">
          <span>商家登陆</span>
        </a>
      </li>

    </ul>
  </div>
</header>
<div class="main">
  <div class="shop-info">
    <div class="shop-title">
      <div class="shop-name">
        <h3>云家政</h3>
        <span>营业时间</span>
        <span class="opening-hours">08:00-18:00</span>
        <span>最近可预约时间</span>
        <span class="subscribe">08月21日 17:00</span>
      </div>
      <div class="shop-rating">
        <div>
          <span class="top">121212</span>
          <span class="down">成功接单</span>
        </div>
        <span class="divide">|</span>
        <div>
          <span class="top">12%</span>
          <span class="down">接单率</span>
        </div>
        <span class="divide">|</span>
        <div>
          <span class="top">12%</span>
          <span class="down">好评率</span>
        </div>
      </div>
    </div>
  </div>
  <div class="shop-nav">
    <ul>
      <li><a href="javascript:;">服务项目</a></li>
      <li><a href="javascript:;">商家简介</a></li>
      <li><a href="javascript:;">用户评论</a></li>
    </ul>
  </div>
  <div class="shop-detail">
    <div class="box">
      <div class="shops-services">
        <h4>
          <a href="javascript:;">
            <span>服务项目</span>
          </a>
        </h4>
        <div class="service-item">
          <div class="image">
            <img src="http://img.daoway.cn/img/price/2017/12/06/50209e47-14f4-4044-a87a-ac5285501dbc_thumb.jpg" alt="">
          </div>
          <div class="service-info">
            <h5>家庭保洁</h5>
            <p>家庭日常保洁服务，2小时起订 如果单次服务时时长未使用完是不...</p>
            <div class="price-info">
              <span class="price">40</span>
              <span>元/小时</span>
              <span class="oldPrice">原价45</span>
              <span class="count">已售1111</span>
            </div>
          </div>
        </div>
        <div class="shop-intro">
          <h4>
            <a href="javascript:;">
              <span>服务项目</span>
            </a>
          </h4>
          <h5>
            上海家谐网络科技有限公司
          <img src="images/renzheng.jpg" alt="">
          </h5>
          <p>
            云家政是家政服务在线预订平台。我们的目标是让每个家庭都能获得诚信、便捷、有保障的家政服务。云家政拥有国内最大的实名认证家庭服务员数据库，目前平台上有超过100000名专业服务人员；数百个家政服务商，遍布全国主要城市各个社区。 云家政倡导简单、轻松的生活方式。通过把分散的家政服务能力汇集和分配，让中国家庭获得诚信、便捷、有保障的家政服务，解决日常生活中的麻烦事，把更多时间留给自己和家人，提高生活品质。

          </p>
        </div>
        <div class="shop-comments">
          <h4>
            <a href="javascript:;">
              <span>用户评论</span>
            </a>
            <p>(90条评论)</p>
          </h4>
          <ul class="comment-list">

          </ul>
          <div class="fenye">
            <div class="pre-page">
              &lt;上一页
            </div>
            <ul class="pageNum">

            </ul>
            <div class="next-page">
              下一页>
            </div>
          </div>
        </div>
      </div>
      <div class="enter">
        <div class="seller">
          <img src="images/seller.jpg" alt="">
        </div>
        <div class="QR-cord">
          <img src="images/2.png" alt="">
        </div>
      </div>
    </div>
  </div>
</div>
<footer>
  <div class="promise">
    <h3>到位
      <span>服务</span>
      保障</h3>
    <p>到位平台担保交易安全，交易未成功100%退款</p>
    <ul>
      <li>
        <img src="images/anquan.jpg" alt="">
        优选服务
      </li>
      <li>
        <img src="images/anquan.jpg" alt="">
        全程保障
      </li>
      <li>
        <img src="images/anquan.jpg" alt="">
        安全无忧
      </li>
    </ul>
  </div>
  <div class="hot-city">
    <h3>热门城市</h3>
    <ul class="city-list">

    </ul>
  </div>
  <div class="beian">
    <p>©2015 版权所有 到位 daoway.com 京ICP备15001471号-1 北京邻家科技有限公司</p>
  </div>
</footer>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="js/template.js"></script>
<script src="js/dist.min.js"></script>
<script id="shops-comments" type="text/html">
  {{each arr as value i}}
  <li class="comment">
    <div class="avatar">
      <img src={{value.iconUrl}} alt="">
      <span class="name">{{value.nick}}</span>
    </div>
    <div class="rating">
      {{if value.star === 5}}
      <span><img src='images/red_star.png' alt=""><img src='images/red_star.png' alt=""><img src='images/red_star.png' alt=""><img src='images/red_star.png' alt=""><img src='images/red_star.png' alt=""></span>
      {{else if value.star === 4}}
      <span><img src='images/red_star.png' alt=""><img src='images/red_star.png' alt=""><img src='images/red_star.png' alt=""><img src='images/red_star.png' alt=""></span>
      {{else if value.star === 3}}
      <span><img src='images/red_star.png' alt=""><img src='images/red_star.png' alt=""><img src='images/red_star.png' alt=""></span>
      {{else if value.star === 2}}
      <span><img src='images/red_star.png' alt=""><img src='images/red_star.png' alt=""></span>
      {{else}}
      <span><img src='images/red_star.png' alt=""></span>
      {{/if}}
      <span>{{value.time}}</span>
    </div>
    <p>{{value.comment}}</p>
    <div class="position">
      <img src="images/position1.jpg" alt="">
      <span>{{value.city}}</span>
      <span>{{value.area}}</span>
    </div>
  </li>
  {{/each}}
</script>
<script id="page-num" type="text/html">
  {{each pageArr as value i}}
  <li class="">{{i + 1}}</li>
  {{/each}}
</script>
<script id="hot-city" type="text/html">
  {{each data as value i}}
  <li><a href="javascript:;">{{value}}</a></li>
  {{/each}}
</script>
<script>
  $(function () {
    $.get('http://localhost:3000/hotCity', function (data){
      let tpl3 = template('hot-city', {data})
      $('.city-list').append(tpl3)
    })
    $.get('http://localhost:3000/comment', function (data) {
      let pageArr=[];
      let commentsArr=[];
      let max = 10 ;
      let index = 0;
      data.forEach(function (item) {
        item.time = timestampToTime(item.createtime)
        if(commentsArr.length === max){
          commentsArr = []
        }
        if(commentsArr.length === 0) {
          pageArr.push(commentsArr)
        }
        commentsArr.push(item)
      })
      switchComments()
      let tpl6 = template('page-num', {pageArr})
      $('.pageNum').append(tpl6)
      $('.pageNum li:first-child').addClass('on')

      //点击页码翻页
      let numList = $(".pageNum li")
      $(numList).on('click', function () {
        $(numList).each(function (index, item) {
          $(item).removeClass('on')
        })
        $(this).addClass('on')
        index = $(this).index()
        $('.comment-list').empty()
        switchComments()
      })

      //点击上一页
      $('.pre-page').on('click', function () {
        if(index >= 1){
          $(numList[index]).removeClass('on')
          index -= 1
          $(numList[index]).addClass('on')
          $('.comment-list').empty()
          switchComments()
        }
      })
      //点击下一页
      $('.next-page').on('click', function () {
        if(index < pageArr.length - 1){
          $(numList[index]).removeClass('on')
          index += 1
          $(numList[index]).addClass('on')
          $('.comment-list').empty()
          switchComments()
        }
      })


      //切换评论
      function switchComments() {
        let arr = pageArr[index]
        let tpl5 = template('shops-comments', {arr})
        $('.comment-list').append(tpl5)
      }
      //时间转换
      function timestampToTime(timestamp) {
        var date = new Date(timestamp);//时间戳为10位需*1000，时间戳为13位的话不需乘1000
        Y = date.getFullYear() + '-';
        M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
        D = date.getDate() + ' ';
        h = date.getHours() + ':';
        m = date.getMinutes() + ':';
        s = date.getSeconds();
        return Y+M+D+h+m+s;
      }
    })
  })
</script>
</body>
</html>